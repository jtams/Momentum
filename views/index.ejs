<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="./css/style.css" />
        <title>Momentum</title>
    </head>
    <body>
        <div id="dash-1">
            <!-- <h1><%= data %></h1> -->
            <!-- <div id="tach"></div> -->
            <div id="tach2">
                <svg class="progress-ring" width="800" height="800">
                    <circle class="progress-ring__circle" stroke="red" stroke-width="4" fill="transparent" r="300" cx="380" cy="380" />
                </svg>
            </div>
            <div id="speed"></div>
            <div id="neutral-container">
                <svg id="neutral" viewBox="0 0 172 137.11">
                    <path
                        d="M308.67,417.11c-2.73,0-6.39-1.3-9.71-6.76L237.81,309.67l.17,89.82A17.5,17.5,0,0,1,220.5,417H185V402h35.5a2.51,2.51,0,0,0,2.48-2.49l-.21-106.7c0-8.55,4.37-11.06,7-11.79s7.67-.88,12.1,6.42l61.2,100.75L303,297.5A17.53,17.53,0,0,1,320.5,280H357v15H320.5a2.48,2.48,0,0,0-1.76.74,2.52,2.52,0,0,0-.74,1.76l.06,107.5c0,8.54-4.39,11-7,11.77A8.64,8.64,0,0,1,308.67,417.11ZM228.48,294.44Z"
                        transform="translate(-185 -280)"
                    />
                </svg>
            </div>
            <div id="gear"></div>
            <div id="lights">
                <svg id="blinker-left" viewBox="0 0 451.846 451.847">
                    <g>
                        <path
                            d="M345.441,248.292L151.154,442.573c-12.359,12.365-32.397,12.365-44.75,0c-12.354-12.354-12.354-32.391,0-44.744
		L278.318,225.92L106.409,54.017c-12.354-12.359-12.354-32.394,0-44.748c12.354-12.359,32.391-12.359,44.75,0l194.287,194.284
		c6.177,6.18,9.262,14.271,9.262,22.366C354.708,234.018,351.617,242.115,345.441,248.292z"
                        />
                    </g>
                </svg>

                <svg id="blinker-right" viewBox="0 0 451.846 451.847">
                    <g>
                        <path
                            d="M345.441,248.292L151.154,442.573c-12.359,12.365-32.397,12.365-44.75,0c-12.354-12.354-12.354-32.391,0-44.744
		L278.318,225.92L106.409,54.017c-12.354-12.359-12.354-32.394,0-44.748c12.354-12.359,32.391-12.359,44.75,0l194.287,194.284
		c6.177,6.18,9.262,14.271,9.262,22.366C354.708,234.018,351.617,242.115,345.441,248.292z"
                        />
                    </g>
                </svg>

                <svg id="fuel-warning" viewBox="0 0 512 512">
                    <g>
                        <path
                            d="M494.313,99.375l-64-32c-15.844-7.93-35.047-1.469-42.938,14.313c-7.906,15.813-1.5,35.031,14.313,42.938L448,147.773V368   c0,8.82-7.172,16-16,16s-16-7.18-16-16V240c0-52.938-43.063-96-96-96V64c0-35.289-28.703-64-64-64H96C60.703,0,32,28.711,32,64   v354.742L9.375,441.375C3.375,447.375,0,455.516,0,464v16c0,17.672,14.328,32,32,32h288c17.672,0,32-14.328,32-32v-16   c0-8.484-3.375-16.625-9.375-22.625L320,418.742V208c17.641,0,32,14.352,32,32v128c0,44.109,35.891,80,80,80s80-35.891,80-80V128   C512,115.883,505.156,104.797,494.313,99.375z M272,223.997h-85.164l-27.977-69.942c-3.281-8.203-12.672-12.172-20.797-8.914   c-8.203,3.289-12.203,12.594-8.922,20.805l23.221,58.052H80v-160c0-8.837,7.163-16,16-16h160c8.837,0,16,7.163,16,16V223.997z"
                        />
                        <circle cx="176" cy="95.997" r="16" />
                        <circle cx="240" cy="111.997" r="16" />
                        <circle cx="112" cy="111.997" r="16" />
                    </g>
                </svg>

                <svg id="overheat" viewBox="0 0 224.594 224.594">
                    <path
                        d="M139.698,128.048V27.401C139.698,12.292,127.406,0,112.297,0S84.896,12.292,84.896,27.401v100.647
	c-15.385,9.466-24.759,26.073-24.759,44.385c0,28.761,23.399,52.161,52.16,52.161s52.16-23.399,52.16-52.161
	C164.457,154.122,155.083,137.515,139.698,128.048z M111.663,200.274c-14.612,0-26.5-11.888-26.5-26.5
	c0-12.238,8.34-22.56,19.634-25.593V27.699c0-4.142,3.357-7.5,7.5-7.5s7.5,3.358,7.5,7.5v120.857
	c10.644,3.441,18.366,13.443,18.366,25.218C138.163,188.387,126.276,200.274,111.663,200.274z"
                    />
                </svg>

                <svg id="oil-pressure" viewBox="0 0 489.915 489.915">
                    <g>
                        <g>
                            <path
                                d="M226.2,440.233c-14.6,5.2-30.2,8.3-46.9,8.3c-76.1,0-138.7-62.6-138.7-139.7c0-59.4,88.6-189.7,137.6-256.5
                       c24,31.3,66.7,90.7,99,149.1c6.3,10.4,18.8,13.6,28.1,8.3c10.4-6.3,13.6-18.8,8.3-28.1c-47.8-85.4-115.6-170.9-117.6-174
                       c-8.3-9.4-25-9.4-32.3,0C147,28.433,0,216.133,0,308.933c0,99,80.3,180.4,179.3,180.4c20.9,0,41.7-4.2,60.5-10.4
                       c11.5-4.2,16.7-15.6,12.5-26.1C248.1,441.333,236.6,436.133,226.2,440.233z"
                            />
                            <path
                                d="M471.2,319.333l-11.2-0.5c-2-15.5-7.3-30.1-15.1-43l8.6-7.5c9.4-8.3,9.4-20.9,2.1-29.2c-8.3-9.4-20.9-9.4-29.2-2.1l-9.1,8
                       c-11.3-8.6-24.2-14.9-38.3-18.5l0.5-11.4c1-11.5-7.3-20.9-18.8-21.9s-20.9,7.3-21.9,18.8l-0.6,12c-15.1,1.8-29.3,6.9-41.8,14.4
                       l-7.7-8.7c-8.3-8.3-20.9-9.4-29.2-2.1c-8.3,8.3-9.4,20.9-2.1,29.2l8.2,9.3c-8.7,11.5-15.1,24.8-18.7,39.2l-11.4-0.5
                       c-11.5-1-20.9,7.3-21.9,18.8s7.3,20.9,18.8,21.9l12.1,0.5c1.8,15.1,6.6,29.3,14.1,42l-8.5,7.5c-9.4,8.3-9.4,20.9-2.1,29.2
                       c8.3,9.4,20.9,9.4,29.2,2.1l8.9-7.8c1.2,0.9,2.4,1.8,3.6,2.7c10.5,7.7,22.9,13.5,35.9,16.8l-0.5,11.3c-1,11.5,7.3,20.9,18.8,21.9
                       h1c10.4,0,19.8-8.3,20.9-18.8l0.5-12.5c14.7-2.1,28.6-7.1,40.9-14.5l7.5,8.6c8.3,8.3,20.9,9.4,29.2,2.1c8.3-8.3,9.4-20.9,2.1-29.2
                       l-7.9-9c8.7-11.3,15.3-24.5,19.1-38.7l10.7,0.5h1c11.5,0,19.8-8.3,20.9-18.8C491,329.733,482.7,320.433,471.2,319.333z
                        M351.3,402.333c-38.7,0-70-31.3-70-70s31.3-70,70-70s70,31.3,70,70S390,402.333,351.3,402.333z"
                            />
                        </g>
                    </g>
                </svg>

                <svg id="fi-light" viewBox="0 0 511.999 511.999">
                    <g>
                        <g>
                            <path
                                d="M494.32,196.801l-4.858-8.131h-85.516v39.564h-8.557v-57.371h-44.32l-28.138-24.95h-46.53v-22.695h14.966V89.827H172.742
			v33.391h14.966v22.695h-48.443l-28.138,24.95H55.791v16.696v66.236h-22.4v-42.616H0v118.625h33.391v-42.617h22.4v66.236v16.696
			h83.474l58.709,52.054h197.414v-58.444h8.557v39.565h85.516l4.858-8.132c1.81-3.027,17.68-31.537,17.68-99.181
			S496.13,199.829,494.32,196.801z M221.101,123.22h21.909v22.695h-21.909V123.22z M468.927,369.902h-31.59v-39.565h-75.34v58.444
			H210.646l-58.709-52.054H89.183V204.255h34.617l28.138-24.95h158.32l28.138,24.95h23.601v57.371h75.34v-39.564h31.59
			c3.873,11.386,9.681,34.956,9.681,73.921C478.609,334.947,472.801,358.516,468.927,369.902z"
                            />
                        </g>
                    </g>
                </svg>
            </div>
        </div>
        <script src="/socket.io/socket.io.js"></script>
        <script src="./js/momentum.js"></script>
        <script>
            momentum.init((bike) => {
                // TACH 1
                // momentum.on("rpmChange", (rpm) => {
                //     document.getElementById("tach").style.width = 100 / (bike.redline / rpm) + "%";
                //     if (100 / (bike.redline / rpm) > 80) {
                //         document.getElementById("tach").style.backgroundColor = "red";
                //     } else if (100 / (bike.redline / rpm) > 70) {
                //         document.getElementById("tach").style.backgroundColor = "yellow";
                //     } else {
                //         document.getElementById("tach").style.backgroundColor = "white";
                //     }
                // });

                // TACH 2
                momentum.on("rpmChange", (rpm) => {
                    // console.log(rpm);
                    let percent = 100 / (bike.redline / rpm);
                    if (percent > 75 && percent < 85) {
                        document.querySelector(".progress-ring__circle").setAttribute("stroke", "yellow");
                    } else if (percent > 85) {
                        document.querySelector(".progress-ring__circle").setAttribute("stroke", "red");
                    } else {
                        document.querySelector(".progress-ring__circle").setAttribute("stroke", "white");
                    }
                    setProgress(100 / (bike.redline / rpm));
                    // console.log(rpm);
                });

                momentum.on("speedChange", (speed) => {
                    document.getElementById("speed").innerHTML = `<p>${speed.toLocaleString("en-US", {
                        minimumIntegerDigits: 2,
                        useGrouping: false,
                    })}<span class="mph">MPH</span></p>`;
                });

                // momentum.on("gearChange", (gear) => {
                //     if (gear == 0) {
                //         gear = "N";
                //     }
                //     document.getElementById("gear").innerHTML = `<p>GEAR: ${gear}</p>`;
                // });

                momentum.on("lightChange", (lights) => {
                    // document.getElementById("lights").innerHTML = "";
                    // lights.forEach((light) => {
                    //     document.getElementById("lights").innerHTML += `<p>${light.name}, Enabled: ${light.enabled}</p>`;
                    // });

                    lights.forEach((light) => {
                        if (light.name == "blinkerLeft") {
                            if (light.enabled) {
                                setTimeout(() => {
                                    document.getElementById("blinker-left").classList.add("left-enabled");
                                }, 55); //Small delay to sync hazards
                            } else {
                                document.getElementById("blinker-left").classList.remove("left-enabled");
                            }
                        }

                        if (light.name == "blinkerRight") {
                            if (light.enabled) {
                                document.getElementById("blinker-right").classList.add("right-enabled");
                            } else {
                                document.getElementById("blinker-right").classList.remove("right-enabled");
                            }
                        }

                        if (light.name == "neutral") {
                            if (light.enabled) {
                                document.getElementById("neutral").style.fill = "rgb(0, 255, 13)";
                            } else {
                                document.getElementById("neutral").style.fill = "rgba(0, 255, 13, 0.062)";
                            }
                        }

                        if (light.name == "temp-warning") {
                            if (light.enabled) {
                                document.getElementById("overheat").style.fill = "rgb(224, 10, 10)";
                            } else {
                                document.getElementById("overheat").style.fill = "rgba(224, 10, 10, 0.192)";
                            }
                        }

                        if (light.name == "fuel") {
                            if (light.enabled) {
                                document.getElementById("fuel-warning").style.fill = "rgb(235, 201, 14)";
                            } else {
                                document.getElementById("fuel-warning").style.fill = "rgba(255, 217, 0, 0.123)";
                            }
                        }

                        if (light.name == "oil") {
                            if (light.enabled) {
                                document.getElementById("oil-pressure").style.fill = "rgb(255, 115, 0)";
                            } else {
                                document.getElementById("oil-pressure").style.fill = "rgba(255, 115, 0, 0.164)";
                            }
                        }

                        if (light.name == "engine") {
                            if (light.enabled) {
                                document.getElementById("fi-light").style.fill = "rgb(224, 10, 10)";
                            } else {
                                document.getElementById("fi-light").style.fill = "rgba(224, 10, 10, 0.192)";
                            }
                        }
                    });
                });
            });

            var circle = document.querySelector("circle");
            var radius = circle.r.baseVal.value;
            var circumference = radius * 2 * Math.PI;

            circle.style.strokeDasharray = `${circumference} ${circumference}`;
            circle.style.strokeDashoffset = `${circumference}`;

            function setProgress(percent) {
                const offset = circumference - (percent / 100) * circumference;
                circle.style.strokeDashoffset = offset;
            }

            // Initialize tachometer
            // function initTach() {
            //     var lineThickness = 40;
            //     var lineCount = window.innerWidth / lineThickness;
            //     for (var i = 0; i < lineCount; i++) {
            //         let line = document.createElement("div");
            //         line.className = "tachLine";
            //         if (i > (lineCount / 3) * 2) {
            //             line.classList.add("warningTach");
            //         }
            //         if (i > (lineCount / 3) * 2.8) {
            //             line.classList.add("redTach");
            //         }
            //         document.getElementById("tach").appendChild(line);
            //     }
            // }

            // momentum.on("rpmChange", (rpm) => {
            //     document.getElementById("tach").innerHTML = `<p>${rpm} RPM</p>`;
            // });
        </script>
    </body>
</html>
